import '../style.css'
import '../components/header.ts'
import '../components/cards.ts'


export function initHome(params: { goTo: (arg: string) => void }): HTMLElement {
  const homePage= document.createElement("div");
  
  homePage.innerHTML = `
  <style>
    .hero-section {
      padding: 5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
    }
  
    .home-title {
      font-size: 2.3rem;
      font-weight: bold;
      color: #db5c5cff;
      margin-top: 3rem;
    }

    .sub-text {
      font-size: 1.8rem;
      color: black;
      text-align: center;
      margin: 1rem 0 3rem 0;
    }

    .button-container{
      padding: 0 0 2rem 0;
    }
    
    .location-access-btn, .info {
      margin: 0 0 1rem 0;
      width: 100%;
    }
    
    .info {
      background-color: var(--green-button-color);
    }



  </style>
  <app-header></app-header>
  <main>
    <div class="hero-section">
      <svg width="216" height="235" viewBox="0 0 216 235" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_8459_307)">
        <path d="M55.8289 101.245C80.6 101.245 100.681 81.2293 100.681 56.5382C100.681 31.8471 80.6 11.831 55.8289 11.831C31.0578 11.831 10.9768 31.8471 10.9768 56.5382C10.9768 81.2293 31.0578 101.245 55.8289 101.245Z" fill="#FF6884"/>
        <path d="M122.837 17.2754L36.4479 64.7077C26.4685 77.4613 216.091 78.2497 214.526 64.7546L130.755 17.3223C128.371 15.9723 125.244 15.9537 122.837 17.2754Z" fill="#5A8FEC"/>
        <path opacity="0.2" d="M122.837 17.2754L36.4479 64.7077C26.4685 77.4613 216.091 78.2497 214.526 64.7546L130.755 17.3223C128.371 15.9723 125.244 15.9537 122.837 17.2754Z" fill="black"/>
        <path opacity="0.8" d="M214.168 235L192.193 234.533H41.5082L0 233.599C137.612 201.182 95.3003 203.973 214.168 235Z" fill="#F2F2F2"/>
        <path d="M193.937 233.599L192.193 234.533H41.5081C144.513 213.339 82.758 215.205 193.937 233.599Z" fill="#CDCDCD"/>
        <path d="M121.128 13.3158H127.614L125.427 1.02828C125.292 0.269131 124.774 0 124.371 0C123.968 0 123.45 0.269131 123.315 1.02828L121.128 13.3158Z" fill="#3F3D56"/>
        <path d="M127.664 53.8579H120.513V227.699H127.664V53.8579Z" fill="#3F3D56"/>
        <path d="M124.109 80.9956C121.058 80.9956 118.19 79.8181 116.022 77.6726L97.9756 59.8132L99.4498 58.3328L117.497 76.1922C119.291 77.968 121.66 78.9373 124.201 78.9092C126.729 78.8854 129.091 77.876 130.852 76.0669L148.097 58.3467L149.599 59.7992L132.354 77.5195C130.201 79.7319 127.312 80.9661 124.22 80.9953C124.183 80.9956 124.146 80.9956 124.109 80.9956Z" fill="#3F3D56"/>
        <path d="M126.609 67.3611C117.729 67.3611 108.779 67.3308 100.092 67.2695C81.6873 67.139 65.9735 66.8814 54.6501 66.524C35.3495 65.915 35.1441 65.2229 35.0561 64.9277C35.036 64.8594 35.029 64.7268 35.2107 64.6076L121.363 8.13521C123.434 6.77377 126.1 6.79228 128.154 8.18375L215.254 64.654C215.436 64.7769 215.427 64.9098 215.405 64.9781C215.297 65.3252 214.967 66.3814 176.723 67.0019C162.173 67.2379 144.538 67.3611 126.609 67.3611Z" fill="#5A8FEC"/>
        <path d="M143.196 151.154L132.277 151.165C131.055 153.874 132.725 157.042 134.861 159.112C136.997 161.182 139.676 162.771 141.253 165.29C144.753 170.881 141.455 178.234 142.611 184.722C144.168 193.46 153.357 198.959 156.156 207.383C157.739 212.148 157.019 217.618 154.257 221.816C153.747 222.591 153.158 223.356 152.98 224.265C152.737 225.502 153.39 226.86 154.51 227.447C155.629 228.033 157.121 227.799 158.006 226.899C157.142 227.877 157.425 229.529 158.395 230.403C159.365 231.278 160.809 231.464 162.088 231.195C166.234 230.322 168.321 225.548 168.489 221.328C168.657 217.108 167.594 212.831 168.423 208.689C168.952 214.634 175.7 218.409 176.229 224.353C176.326 225.455 170.219 228.768 170.787 229.718C172.224 232.119 175.648 232.128 178.438 231.84C183.241 231.345 188.575 230.573 191.588 226.812C193.618 224.278 194.144 220.867 194.211 217.625C194.385 209.161 191.855 200.662 187.079 193.662C180.721 184.345 170.614 177.743 165.623 167.633C163.927 164.197 162.889 160.471 161.238 157.013C159.588 153.555 157.16 150.246 153.648 148.694C150.136 147.143 145.407 147.908 143.38 151.161" fill="#3F3D56"/>
        <path d="M177.053 225.53C176.836 225.53 176.623 225.484 176.422 225.39C176.266 225.318 176.199 225.133 176.271 224.978C176.344 224.822 176.529 224.754 176.686 224.827C177.029 224.987 177.361 224.882 177.578 224.766C178.023 224.528 178.373 224.04 178.447 223.552C178.59 222.608 178.116 221.645 177.697 220.794C176.477 218.315 175.271 215.66 175.09 212.854C174.886 209.691 176.196 206.744 178.428 205.347C180.087 204.309 182.28 204.037 184.604 204.581C186.594 205.048 188.428 206.027 190.288 207.074C190.438 207.158 190.491 207.348 190.406 207.497C190.321 207.647 190.131 207.7 189.981 207.615C188.093 206.552 186.374 205.635 184.461 205.186C182.301 204.68 180.276 204.924 178.759 205.873C176.718 207.15 175.522 209.875 175.712 212.814C175.886 215.506 177.064 218.097 178.257 220.521C178.693 221.407 179.236 222.509 179.063 223.645C178.96 224.327 178.492 224.982 177.872 225.314C177.603 225.457 177.325 225.53 177.053 225.53Z" fill="#2F2E41"/>
        <path d="M158.887 156.561C160.49 159.73 159.644 163.94 156.941 166.249C156.361 166.746 155.707 167.161 155.188 167.72C154.669 168.28 154.288 169.038 154.419 169.789C152.648 168.038 150.842 166.239 149.771 163.993C148.7 161.748 148.491 158.929 149.885 156.867C150.55 155.883 151.519 155.145 152.274 154.228C153.029 153.311 153.573 152.062 153.165 150.948" fill="#2F2E41"/>
        <path d="M190.734 217.431C189.888 220.012 191.282 222.982 193.57 224.457C195.858 225.932 198.814 226.085 201.455 225.418C206.562 224.127 210.756 219.769 211.837 214.629C212.287 212.491 212.255 210.2 213.273 208.266C213.913 207.05 214.969 205.952 214.999 204.58C215.024 203.464 214.298 202.405 213.307 201.887C212.316 201.368 211.109 201.35 210.042 201.688C207.5 202.493 205.94 205.059 205.131 207.593C204.322 210.127 204.02 212.836 202.844 215.223C201.669 217.61 199.239 219.694 196.596 219.33C194.311 219.015 192.377 216.961 190.087 217.241" fill="#3F3D56"/>
        <path d="M63.0369 185.221C59.9458 185.694 57.6846 187.666 57.9865 189.627C58.2884 191.588 61.0386 192.794 64.1307 192.321C65.3685 192.149 66.547 191.684 67.5675 190.965L89.9286 187.607L90.7713 179.907L66.7246 185.489C65.5344 185.107 64.2699 185.016 63.0369 185.221Z" fill="#FFB6B6"/>
        <path d="M119.366 169.167L114.298 179.888L88.8169 188.438L90.0585 179.725L113.572 168.649L119.366 169.167Z" fill="#E6E6E6"/>
        <path d="M72.3703 209.874L67.8197 221.348L61.9307 217.345L65.4105 205.339L72.3703 209.874Z" fill="#FFB6B6"/>
        <path d="M53.3648 205.605L41.3191 217.078L46.1374 222.148L58.4507 212.543L53.3648 205.605Z" fill="#FFB6B6"/>
        <path d="M121.624 168.251L121.49 167.317L118.412 161.314L108.24 163.982L110.114 172.253L121.624 168.251Z" fill="#FFB6B6"/>
        <path d="M117.341 208.274L117.654 212.281C117.654 212.281 118.947 229.085 108.507 230.419C98.0677 231.754 93.5171 233.088 87.3604 222.682L77.7238 205.605L72.0951 212.281L64.6074 206.406C64.6074 206.406 69.9611 185.594 74.244 184.794C74.7793 184.694 75.3147 184.644 75.8417 184.633C79.3874 184.559 82.7298 186.288 84.8512 189.121L96.997 205.339L101.414 203.337L117.341 208.274Z" fill="#2F2E41"/>
        <path d="M59.5215 220.814L62.2263 216.836L68.4341 219.773C68.4341 219.773 70.4965 226.951 68.0873 227.751C65.6782 228.552 58.9862 227.484 58.9862 227.484C58.9862 227.484 46.6728 230.153 46.4051 227.751C46.1374 225.35 52.0264 224.816 52.0264 224.816L59.5215 220.814Z" fill="#FFB6B6"/>
        <path d="M85.7544 217.612L67.1505 205.928L57.6478 214.41L51.2234 206.939C51.2234 206.939 63.0014 189.596 66.4813 188.796C69.9611 187.995 75.5825 187.462 75.5825 187.462L92.7141 203.204L85.7544 217.612Z" fill="#2F2E41"/>
        <path d="M42.6158 216.054L46.5499 221.648L46.3959 223.374C46.3959 223.374 44.7987 230.308 41.0511 227.962C37.3036 225.617 37.0359 225.083 37.0359 225.083C37.0359 225.083 26.3286 227.484 25.2579 223.215C24.1871 218.946 27.1316 219.747 27.1316 219.747L29.8053 221.348L40.2272 217.875L42.6158 216.054Z" fill="#FFB6B6"/>
        <path d="M111.452 166.917C116.183 166.917 120.018 163.094 120.018 158.379C120.018 153.663 116.183 149.841 111.452 149.841C106.721 149.841 102.886 153.663 102.886 158.379C102.886 163.094 106.721 166.917 111.452 166.917Z" fill="#FFB6B6"/>
        <path d="M109.444 170.519L121.758 166.783C121.758 166.783 126.576 177.99 125.773 183.059C124.97 188.129 117.654 212.281 117.654 212.281L101.414 203.337C101.414 203.337 101.146 198.001 100.343 195.6C99.54 193.198 96.9971 185.861 102.618 179.724C108.24 173.587 109.444 170.519 109.444 170.519Z" fill="#E6E6E6"/>
        <path d="M82.3432 226.546C80.3393 228.939 79.9536 231.909 81.4817 233.18C83.0098 234.451 85.8725 233.541 87.8768 231.147C88.6906 230.202 89.2655 229.076 89.5532 227.863L108.523 206.662L102.644 203.494L85.2853 224.313C84.1398 224.813 83.131 225.578 82.3432 226.546Z" fill="#FFB6B6"/>
        <path d="M118.889 175.902L121.799 187.393L107.554 210.121L108.84 209.829L101.055 204.128L102.965 202.603L114.082 179.167L118.889 175.902Z" fill="#E6E6E6"/>
        <path d="M103.555 156.911C105.752 156.906 105.877 156.921 106.232 156.911C108.957 156.84 109.669 155.771 111.05 155.844C113.515 155.974 110.262 168.293 108.909 173.988C107.582 179.573 112.066 184.578 112.389 184.927C116.941 189.862 124.936 190.764 126.308 188.662C127.419 186.962 123.483 184.375 124.434 180.658C125.364 177.024 129.658 177.411 130.859 173.988C132.116 170.402 127.891 168.594 125.237 159.846C123.713 154.822 123.983 153.886 122.561 150.774C118.759 142.457 100.125 145.998 102.217 153.709C102.621 155.201 101.544 156.916 103.555 156.911Z" fill="#2F2E41"/>
        </g>
        <defs>
        <clipPath id="clip0_8459_307">
        <rect width="215.417" height="235" fill="white"/>
        </clipPath>
        </defs>
      </svg>
      <h1 class="home-title">Pet Finder App</h1>
      <p class="sub-text">Encontrá y reportá mascotas perdidas cerca de tu ubicación</p>
      <div class="button-container">
        <button class="location-access-btn">Dar mi ubicación actual</button>
        <button class="info">¿Cómo funciona Pet Finder?</button>
      </div>
    </div>

  </main>
`
  const misDatosBtn = homePage.querySelector(".menu-item[href='/profile']");
  misDatosBtn?.addEventListener("click", () => {
    params.goTo("/profile");
  });

  const locationAccessBtn = homePage.querySelector(".location-access-btn");
  locationAccessBtn?.addEventListener("click", () => {
    // Verificar si el navegador soporta geolocalización
    if ("geolocation" in navigator) {
      // Cambiar texto del botón mientras se obtiene la ubicación
      (locationAccessBtn as HTMLButtonElement).textContent = "Obteniendo ubicación...";
      (locationAccessBtn as HTMLButtonElement).disabled = true;
      
      // Solicitar ubicación del usuario
      navigator.geolocation.getCurrentPosition(
        (position) => {
          // Éxito: obtener coordenadas
          const latitude = position.coords.latitude;
          const longitude = position.coords.longitude;
          
          console.log("Ubicación obtenida:", { latitude, longitude });
          
          // Almacenar la ubicación en localStorage para usarla en /home/pets
          localStorage.setItem('userLocation', JSON.stringify({
            latitude,
            longitude,
            timestamp: Date.now()
          }));
          
          // Redirigir a la página de mascotas perdidas
          params.goTo("/home/pets");
        },
        (error) => {
          // Error al obtener ubicación
          console.error("Error obteniendo ubicación:", error);
          
          let errorMessage = "Error al obtener ubicación. ";
          switch(error.code) {
            case error.PERMISSION_DENIED:
              errorMessage += "Permiso denegado por el usuario.";
              break;
            case error.POSITION_UNAVAILABLE:
              errorMessage += "Información de ubicación no disponible.";
              break;
            case error.TIMEOUT:
              errorMessage += "Tiempo de espera agotado.";
              break;
            default:
              errorMessage += "Error desconocido.";
              break;
          }
          
          alert(errorMessage + " Mostrando mascotas de ubicación por defecto.");
          
          // Restaurar botón
          (locationAccessBtn as HTMLButtonElement).textContent = "Dar mi ubicación actual";
          (locationAccessBtn as HTMLButtonElement).disabled = false;
          
          // Ir a /home/pets sin ubicación (usará ubicación por defecto)
          params.goTo("/home/pets");
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 300000 // 5 minutos
        }
      );
    } else {
      alert("Tu navegador no soporta geolocalización. Mostrando mascotas de ubicación por defecto.");
      params.goTo("/home/pets");
    }
  });

  return homePage;
}